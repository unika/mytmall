<include file="Public:header" />
<script>
	$(document).ready(function() {
		$(".delgoods").click(function() {
			var obj = $(this);
			var num = $(this).parents("tr").find(".num").val();
			if (num > 1) {
				num--;
				$(this).parents("tr").find(".num").val(num);
				$.post("__URL__/delGoods", {
					'id' : $(this).attr("aid"),
					'num' : num,
				}, function(data) {
					$("#item").text(data.data.message.total_num);
					$("#Total_num").empty().text(data.data.message.total_num);
					$("#Total_price").empty().text(data.data.message.total_price);
					$("#sys_Subtotal").empty().text(data.data.message.total_price);
					$("#sys_GrandTotal").empty().text(data.data.message.total_price);

				}, 'json');
			} else {
				$.confirm("确定要删除吗", function() {
					$.get("__URL__/delCart", {
						'id' : obj.attr("aid"),
					}, function(data) {
						if (data.status == 1) {
							obj.parents("tr").remove();
							$("#item").text(data.data.message.total_num);
							$("#Total_num").empty().text(data.data.message.total_num);
							$("#Total_price").empty().text(data.data.message.total_price);
							$("#sys_Subtotal").empty().text(data.data.message.total_price);
							$("#sys_GrandTotal").empty().text(data.data.message.total_price);
						} else {
							$.alert(data.info);
						}

					}, 'json');

				}, function() {
					this.close()
				})
			}
		})
		$(".remove").click(function() {
			$.get("__URL__/delCart", {
				'id' : $(this).attr("aid"),
			}, function(data) {
				if (data.status == 1) {
					$("#item").text(data.data.message.total_num);
					$("#Total_num").empty().text(data.data.message.total_num);
					$("#Total_price").empty().text(data.data.message.total_price);
					$("#sys_Subtotal").empty().text(data.data.message.total_price);
					$("#sys_GrandTotal").empty().text(data.data.message.total_price);
				} else {
					$.alert(data.info);
				}

			}, 'json');
			$(this).parents("tr").remove();
		})
		$(".addgoods").click(function() {
			var num = $(this).parents("tr").find(".num").val();
			num++;
			$(this).parents("tr").find(".num").val(num);
			$.post("__URL__/addGoods", {
				'id' : $(this).attr("aid"),
				'num' : num,
			}, function(data) {
				$("#item").text(data.data.message.total_num);
				$("#Total_num").empty().text(data.data.message.total_num);
				$("#Total_price").empty().text(data.data.message.total_price);
				$("#sys_Subtotal").empty().text(data.data.message.total_price);
				$("#sys_GrandTotal").text(parseFloat($("#Total_price").text(), 10) - parseFloat($("#sys_Coupon").text(), 10));
			}, 'json');

		})
		//优惠券的有效性验证及使用
		$("#btnValidate").click(function() {
			$.post("__URL__/validCoupon", {
				"No" : $("#Text1").val()
			}, function(data) {
				if (data.status == 1) {
					$("#btnValidate").attr("disabled", "disabled");
					$("#btnValidate").after("<span>本次" + data.info + "一次只能使用一张</span>");
					$("#sys_Coupon").text(data.data.Price);
					//为总价-优惠券的价格=最总价格
					$("#sys_GrandTotal").text(parseFloat($("#Total_price").text()).toFixed(2) - parseFloat($("#sys_Coupon").text()).toFixed(2));
					$.alert(data.info);
				} else {
					$("#sys_GrandTotal").text($("#Total_price").text());
					$.alert(data.info);
				}
			}, 'json');
		});

	})
	function gopay() {
		$("#cart_info").submit();
	}

</script>

<div id="main">
	<div id="main2">
		<div id="shop_l">
			<div class="cart_top">
				<div class="fixed_title"><img src="__MYSTYLE__Images/shoppingnag.jpg">
				</div>
				<div class="checkbotton">
					<img class="cart_checkout" alt="Proceed to Checkout" onclick="gopay();" src="__MYSTYLE__Images/securecheck.jpg">
					<img alt="continue" onclick='document.location.href="/"' class="cart_btn" src="__MYSTYLE__Images/continue.jpg">
				</div>
			</div>
			<!---购物车Widget开始-->
			<div id="cart_table">
				<form id="cart_info" action="/Order/step1" method="post">
					<table id="sys_num">
						<thead>
							<tr>
								<!-- <th style="text-indent: 0px; text-align: center" class="cart_table1_th1"> &nbsp;</th> -->
								<th class="cart_table1_th2"> Product Pic </th>
								<th class="cart_table1_th2"> Product Name </th>
								<th class="cart_table1_th4"> Product AttrValue </th>
								<th class="cart_table1_th4"> Unit Price </th>
								<th class="cart_table1_th5"> QTY </th>
								<th class="cart_table1_th8"> Subtotal </th>
							</tr>
						</thead>
						<tbody>
							<!--循环读取购物车内的商品开始-->
							<volist name="goods" id="vo">
								<tr>
									<!--购物车图片-->
									<td><a target="_top" href="#"> <img src="{$vo.item_image}" width="64"></a></td>
									<td>										
										<a target="_top" href="#">{$vo.item_name}</a>
										<br>
										<br>
										<div style=" padding-top:6px; float:left;">
											<a style=" text-decoration:underline;" href="" target="_top">Edit</a>&nbsp; <a target="_top"  class="remove" aid="{$vo.item_id}" style="text-decoration:underline;" href="javascript:void(0);">Remove</a>
										</div>
									</td>
									<td>
									<foreach name="vo.item_attrValue" key="$key" item="subvo">
										{$subvo}<br/>
										
									</foreach>
									</td>
									<td style="padding: 0;text-align: center;width: 100px;"> {$vo.item_price} </td>
									<td style="padding: 0;text-align: center;width: 100px;">
									<table style="display:inline;">
										<tbody>
											<tr id="num">
												<td>
												<input class="num" value="{$vo.item_num}" size="5" style="text-align: center" onkeyup="" class="line" id="sys_1_Num">
												</td>
												<td>
												<div style="padding-bottom: 2px">
													<a href="javascript:void(0);" class="addgoods" aid="{$vo.item_id}" style="display: block;"> <img  src="__MYSTYLE__Images/good_detail_up.gif" style="cursor: pointer;" /></a>
													<a href="javascript:void(0);"  class="delgoods" aid="{$vo.item_id}" style="display: block;"> <img  src="__MYSTYLE__Images/good_detail_down.gif" style="cursor: pointer;" /></a>
												</div></td>
											</tr>
										</tbody>
									</table></td>
									<td id="sys_1_Subtotal" style="padding: 0;text-align: center;width: 100px;"> {$vo.item_price} </td>
								</tr>
							</volist>
							<!--循环读取购物车内的商品结束-->
						</tbody>
					</table>
					<div class="clear"></div>
			</div>
			<div class="cart_col5">
				<div class="cart_discount">
					<b>Discount Codes</b>
					<input id="Text1" class="input-text" name="Coupon" onblur="if (this.value == '') this.value = 'Enter your coupon code :';" onfocus="if (this.value == 'Enter your coupon code :') this.value = '';" value="Enter your coupon code :" type="text">
					<button id="btnValidate" type="button" onclick="" class="cart_btn"><img src="__MYSTYLE__Images/apply.jpg" alt="">
					</button>
					<div class="clear"></div>
					<span class="valid" mode="border"></span>
				</div>
				<dl class="cart_total">
					<dd>
						<b>Subtotal</b><b>$<span id="sys_Subtotal">
							<empty name="total_price">
								0.00
								<else/>
								{$total_price}
							</empty> </span></b>
					</dd>
					<!--优惠券-->
					<dd>
						<b>Coupon</b><b>$<span id="sys_Coupon">
							<empty name="total_Coupon">
								0.00
								<else/>
								{$total_Coupon}
							</empty></span></b>
					</dd>
					<!--优惠券-->

					<dd>
						<b>Total_num</b><b><span id="Total_num">
							<empty name="total_num">
								0.00
								<else/>
								{$total_num}
							</empty> </span></b>
					</dd>
					<!--应该减优惠券-->
					<dd>
						<b>Total_price</b><b>$<span id="Total_price" >
							<empty name="total_price">
								0.00
								<else/>
								{$total_price}
							</empty> </span></b>
					</dd>
					<!--应该减优惠券-->
					<dd class="cart_strong">
						<b>Grand Total:</b><b class="red2">$<span id="sys_GrandTotal">
							<empty name="total_price">
								0.00
								<else/>
								{$total_price}
							</empty> </span></b>
					</dd>
					<dt><img alt="continue" onclick='document.location.href="/"' class="cart_btn" src="__MYSTYLE__Images/continue.jpg"><img class="cart_checkout" alt="Proceed to Checkout" onclick="gopay();" src="__MYSTYLE__Images/securecheck.jpg">
					</dt>
				</dl>
			</div>
			<div class="clear"></div>
			<!---购物车Widget结束-->
			</form>
		</div>

		<div id="shop_r">
			<!--同类商品推荐Widget-->
			<p class="may2_t">
				MAY WE SUGGEST
			</p>
			<div class="may2">

				<div class="list">
					<a target="_top" class="may2_img" title="Oakley Frogskin Lifestyle Oversize Sunglasses" href="http://www.usefulsunglasses.com/Oakley-Frogskin-Lifestyle-Oversize-Sunglasses-p-5549.html"><img title="Oakley Frogskin Lifestyle Oversize Sunglasses" alt="Oakley Frogskin Lifestyle Oversize Sunglasses" src="__MYSTYLE__Images/SG0000000480_1.jpg"></a>
					<a target="_top" class="may2_name" title="Oakley Frogskin Lifestyle Oversize Sunglasses" href="http://www.usefulsunglasses.com/Oakley-Frogskin-Lifestyle-Oversize-Sunglasses-p-5549.html">Oakley Frogskin Lifestyle Oversize Sunglasses</a>

					<div class="may2_price">
						<span class="sys_cur">$</span><span class="sys_p">15.99</span>
					</div>

				</div>

				<div class="list">
					<a target="_top" class="may2_img" title="Oakley Plaintiff Lifestyle Oversize Sunglasses" href="http://www.usefulsunglasses.com/Oakley-Plaintiff-Lifestyle-Oversize-Sunglasses-p-5704.html"><img title="Oakley Plaintiff Lifestyle Oversize Sunglasses" alt="Oakley Plaintiff Lifestyle Oversize Sunglasses" src="__MYSTYLE__Images/SG0000000325_1.jpg"></a>
					<a target="_top" class="may2_name" title="Oakley Plaintiff Lifestyle Oversize Sunglasses" href="http://www.usefulsunglasses.com/Oakley-Plaintiff-Lifestyle-Oversize-Sunglasses-p-5704.html">Oakley Plaintiff Lifestyle Oversize Sunglasses</a>

					<div class="may2_price">
						<span class="sys_cur">$</span><span class="sys_p">15.99</span>
					</div>
				</div>
			</div>
			<!--同类商品推荐Widget-->
			<div class="may2_b"></div>
		</div>
	</div>

</div>

<div class="clear"></div>
<include file="Public:footer" />
